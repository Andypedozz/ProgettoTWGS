<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Segnalazioni</title>
    <link rel="stylesheet" type="text/css" href="style.css" />
    <link rel="stylesheet" type="text/css" href="src/pages/segnalazioni/segnalazioni.css" />
</head>
<body>
    <header>
        <h1 id="title">SISTEMA DI CONSULTAZIONE TERREMOTI ITALIANI</h1>
        <nav id="navlist">
            <ul>
                <li><a href="/home">Home</a></li>
                <li><a href="/segnalazioni">Segnalazioni</a></li>
                <li><a href="/ricerca">Ricerca</a></li>
                <li><a href="/create">Aggiungi una segnalazione</a></li>
                <li><a href="/stats">Statistiche</a></li>
            </ul>
        </nav>
    </header>
    <table id="tabella">
        <thead>
            <tr>
                <th>ID</th>
                <th>EventID</th>
                <th>Data e ora (Italia)</th>
                <th>Latitudine</th>
                <th>Longitudine</th>
                <th>Profondit√†</th>
                <th>Autore</th>
                <th>MagType</th>
                <th>Magnitudo</th>
                <th>Zona</th>
            </tr>
        </thead>
        <tbody>
        </tbody>
    </table>
    <div class="page-buttons">
        <button id="previous-page" onclick="previousPage()">Indietro</button>
        <label id="page-index">1</label>
        <button id="next-page" onclick="nextPage()">Avanti</button>
        <!-- TABLE GET REQUEST -->
        <script id="load-table">
            function loadTable() {
                const page = document.getElementById("page-index").innerText;
                const resultsPerPage = 28;
            
                let startIndex = (page - 1) * resultsPerPage;
                let endIndex = startIndex + resultsPerPage;
            
                const url = "/earthquakes?startIndex="+startIndex+"&endIndex="+endIndex;
                fetch(url, {
                    method: "GET",
                    headers: {
                        "Content-Type" : "application/json"
                    }
                })
                .then(response => response.json())
                .then(data => {
                    const table = document.getElementById("tabella");
                    const tbody = table.getElementsByTagName("tbody")[0];
                    let records = data.slice();
        
                    for(var i = 0; i < records.length; i++) {
                        let newRow = tbody.insertRow();
                        for(var j = 0; j < records[i].length; j++) {
                            let newCell = newRow.insertCell();
                            newCell.innerHTML = records[i][j];
                        }
                    }
                })
                .catch(error => console.error("Errore: "+error));
            }

            loadTable();
        </script>
    </div>
    <!-- TABLE SWITCH PAGES -->
    <script id="pages-buttons-logic">
        function nextPage() {
            let pageIndex = document.getElementById("page-index");
            let value = pageIndex.innerText;
            pageIndex.innerHTML = parseInt(value) + 1;
            clearTable();
            loadTable();
        }

        function previousPage() {
            let pageIndex = document.getElementById("page-index");
            let value = pageIndex.innerText;
            if(parseInt(value) !== 1) {
                pageIndex.innerHTML = parseInt(value) - 1;
                clearTable();
                loadTable();
            }
        }

        function clearTable() {
            const table = document.getElementById("tabella");
            const tbody = table.getElementsByTagName("tbody")[0];
            while(tbody.firstChild) {
                tbody.removeChild(tbody.firstChild);
            }
        }
    </script>
</body>
</html>